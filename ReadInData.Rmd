---
title: "Read-In-Data"
author: "MD,DM"
date: "'r format(Sys.time(), '%b %d, %Y')'"
output: 
 html_document:
   toc: true
   toc_float: true
 editor_options:
   chunck_output_type: console
   chunk_output_type: console
---

```{r}
library(tidyverse)
library(readxl)
library(writexl)
library(phyloseq)


source('DManter_CustomFunctions.R')

```


```{r}
P.a <- emu_to_phyloseq(RA_file = 'data/EMU_rel.abund_A.csv',
                        meta_file = 'data/Carley_F_clean.xls',
                        sheet = 'Carley_F_clean',range = 'A1:N81',
                        sample_names = 'name',
                        run_name = 'CRF')

P.b <- emu_to_phyloseq(RA_file = 'data/EMU_rel.abund_B.csv',
                        meta_file = 'data/Carley_G_clean.xlsx',
                        sheet = 'Sheet1',range = 'A1:N81',
                        sample_names = 'name',
                        run_name = 'CRG')

P.rel <- merge_phyloseq(P.a, P.b) %>% 
  subset_samples(., final > 10000)
  
saveRDS(P.rel,'data/P.rel.RDS')

P.count <- P.rel 
for (n in 1:nsamples(P.count)) {
  otu_table(P.count)[,n] <- round(otu_table(P.count)[,n] * sample_data(P.count)$final[n], 0)
}

saveRDS(P.count, 'data/P.count.RDS')
```
